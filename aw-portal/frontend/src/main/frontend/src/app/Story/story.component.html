<div class="story-wrapper">
  <div class="btn-group-vertical btn-group-xs col-xs-1" role="group" aria-label="move">
    <button type="button" class="btn btn-default" (click)="moveUp()"
      [disabled]="story.order == 0">
      <span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span>
    </button>
    <button type="button" class="btn btn-default" (click)="moveDown()"
      [disabled]="story.order == swimlane.stories.length-1">
      <span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span>
    </button>
  </div>
  <!-- Story button, with modal attachment -->
  <button class="btn btn-info" (click)="storyModal.show(); loadOtherSwimlanes(swimlane.id)">
      <span class="badge">{{story.points}}</span> <span class="wordwrap">{{story.title}}</span>
  </button>
</div>
	
<!-- Modal -->
<!-- <input [(ngModel)]="newStory.title" type="text" placeholder="title"/> <br>
<input [(ngModel)]="newStory.description" type="text" placeholder="description"/> <br>
<input [(ngModel)]="newStory.points" id="points" type="number" class="form-control" min=1 max=10 style="width:20%; margin:auto" placeholder="points"> -->

<app-modal #storyModal>
  <div class="app-modal-header">
    <button type="button" class="close" (click)="editing = false; storyModal.hide()" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>

    <div *ngIf="editing; else notEditingHeader">
      <input type="number" [(ngModel)]="story.points" min=1 max=10 required />
      <input type="text" [(ngModel)]="story.title" required />
    </div>
    <ng-template #notEditingHeader>
      <h4 class="modal-title" id="myModalLabel"><span class="badge">{{story.points}}</span> {{story.title}}</h4>
    </ng-template>
  </div>
  <div class="app-modal-body">


    <h5>Description</h5>
    <div *ngIf="editing; else noDesc">
      <textarea [(ngModel)]="story.description"></textarea>
      <br><br>
      <h5>Completed?</h5>>
      <input [(ngModel)]="isCompleted" type="checkbox" /> <br>
    </div>
    <ng-template #noDesc>
      <span *ngIf="story.description">&emsp;{{story.description}}</span>
      <span *ngIf="!story.description">&emsp;No description</span>
      <br><br>
      <h5>Tasks</h5>
      <table *ngIf="story.tasks?.length; else noTasks" class="table table-hover table-condensed">
        <tr *ngFor="let task of story.tasks">
          <td><aw-task [task]="task" [story]="story" [board]="board"></aw-task></td>
        </tr>
      </table>
      <ng-template #noTasks>
        <div>
          &emsp;No tasks yet
        </div>
      </ng-template>
      <div class="form-group input-group col-sm-offset-1 col-sm-8">
        <input class="form-control" [(ngModel)]="newTask.name" type="text" required/>
        <span class="input-group-btn">
            <button class="btn btn-default" type="button" (click)="createTask(newTask)">
                Add Task
            </button>
        </span>
      </div>
    </ng-template>
  </div>
  <div class="app-modal-footer">

    
    <!-- Where the check story completion is located at-->
    
    <!-- <button type="button" class="btn btn-default" data-ng-hide="story.dateStoryCompleted" data-ng-click="markAsFinished()">
      <span class="glyphicon glyphicon-check" aria-hidden="true"></span>
    </button> -->
    <div *ngIf="editing; else noEditButtons">
        <button type="button" class="btn btn-success" (click)="updateStory(); editing = !editing">
          Save Changes
        </button>
        <button type="button" class="btn btn-danger" (click)="editing = !editing">
          Cancel
        </button>
    </div>
    <ng-template #noEditButtons>
      <div ngbDropdown>
        <button type="button" class="btn btn-primary" id="dropdownBasic1" ngbDropdownToggle>
          Move to... <span class="caret"></span>
        </button>
        <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
            <li *ngFor="let otherSwimlane of loadOtherSwimlanes()">
                <a (click)="moveTo(otherSwimlane.id, otherSwimlane.stories.length, otherSwimlane.order)">{{otherSwimlane.name}}</a>
            </li>
        </div>
        <div class="btn-group">
          <button type="button" class="btn btn-default" (click)="editing = !editing">
            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
          </button>
          <button type="button" class="btn btn-danger" (click)="deleteStoryModal.show()">
            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
          </button>
        </div>
      </div>
    </ng-template>
  </div>
</app-modal>

<!-- <div class="modal fade" data-ng-attr-id="{{ 'modal' + story.id }}"
  tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"
          data-ng-click="closeModal()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <div data-ng-hide="editing">
          <h4 class="modal-title" id="myModalLabel"><span class="badge">{{story.points}}</span> {{story.title}}</h4>
        </div>
        <div data-ng-if="editing">
          <input type="number" data-ng-model="story.points" min=1 max=10 required />
          <input type="text" data-ng-model="story.title" required />
        </div>
      </div>
      <div class="modal-body">
        <h5>Description</h5>
        <div data-ng-if="editing">
          <textarea data-ng-model="story.description"></textarea>
        </div>
        <div data-ng-hide="editing">
          <span data-ng-if="story.description">&emsp;{{story.description}}</span>
          <span data-ng-hide="story.description">&emsp;No description</span>
          <br><br>
          <h5>Tasks</h5>
          <div data-ng-hide="story.tasks.length">&emsp;No tasks yet
          </div>
          <table class="table table-hover table-condensed">
            <tr data-ng-repeat="task in story.tasks">
              <td><scrum-task task="task" story="story"></scrum-task></td>
            </tr>
          </table>
          <form>
            &emsp; <input type="text" data-ng-model="newTask.name" required />
            <button class="btn btn-default" data-ng-click="createTask()">Add
              Task</button>
          </form>
        </div>
      </div>
      <div class="modal-footer">
        <div data-ng-hide="editing">
          <div class="btn-group dropup">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Move to... <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
              <li data-ng-repeat="otherSwimLane in otherSwimLanes">
                <a data-ng-click="moveTo(otherSwimLane)" data-dismiss="modal">{{otherSwimLane.name}}</a>
              </li>
            </ul>
          </div>
          
          <button type="button" class="btn btn-default" data-ng-hide="story.dateStoryCompleted" data-ng-click="markAsFinished()">
            <span class="glyphicon glyphicon-check" aria-hidden="true"></span>
          </button>
          
          
          <button type="button" class="btn btn-default"
            data-ng-click="resetNewTask(); edit()">
            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
          </button>
          <button type="button" class="btn btn-danger" data-toggle="modal" data-ng-attr-data-target="{{ '#deleteStory' + story.id }}">
            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
          </button>
        </div>
        <div data-ng-if="editing">
          <button type="button" class="btn btn-success"
            data-ng-click="update()">
            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
          </button>
          <button type="button" class="btn btn-danger"
            data-ng-click="reset()">
            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div> -->

<app-modal #deleteStoryModal>
		<div class="app-modal-header">
			<h4 class="modal-title" id="myModalLabel">
				Delete Story "{{story.title}}"
			</h4>
			<button type="button" class="close"  (click)="deleteStoryModal.hide()" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			
		</div>
		<div class="app-modal-body">
			<span>Are you sure that you wish to delete {{story.title}}?</span>
		</div>
		<div class="app-modal-footer">
			  <button type="button" class="btn btn-danger" (click)="deleteStory(story); deleteStoryModal.hide(); storyModal.hide()">Delete</button>
			  <button type="button" class="btn btn-default" (click)="deleteStoryModal.hide()">Close</button>
		</div>
	</app-modal>